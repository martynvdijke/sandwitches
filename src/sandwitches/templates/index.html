{% extends "base_beer.html" %}
{% load i18n static %}

{% block title %}Sandwitches{% endblock %}

{% block content %}
<div class="large-space"></div>

<article class="round primary s12 m12 l12">
  <div class="row align-center">
    <div class="max">
      <h4 class="upper">{% trans 'Sandwitches' %}</h4>
      <p class="large-text">{% trans 'Sandwiches so good, they haunt you!' %}</p>
    </div>
    <div class="field prefix round fill white-text border s12 m5 l4">
      <i class="front">search</i>
      <input id="search" type="text" class="white-text" placeholder="{% trans 'Search recipes...' %}" aria-label="{% trans 'Search' %}">
    </div>
  </div>
</article>

<div class="large-space"></div>

<div class="grid justify-center">
  {% for recipe in recipes %}
  <div class="s12 m6 l4 xl3 recipe-card">
    <article class="round no-padding elevate">
       <div style="position: relative;">
         {% if recipe.image %}
         <img src="{{ recipe.image_medium.url }}" class="responsive top-round" style="height:220px; width:100%; object-fit:cover; cursor:pointer;" loading="lazy" alt="{{ recipe.title }}" onclick="location.href='{% url 'recipe_detail' recipe.slug %}';">
         {% else %}
         <div class="primary medium-height top-round middle-align center-align" style="height:220px; cursor:pointer;" onclick="location.href='{% url 'recipe_detail' recipe.slug %}';">
           <i class="extra">lunch_dining</i>
         </div>
         {% endif %}
         
         {% if user.is_authenticated %}
         <div class="absolute top left padding">
             <a href="{% url 'toggle_favorite' recipe.pk %}" class="button circle surface white-text">
                <i class="{% if recipe in user.favorites.all %}error-text{% else %}black-text{% endif %}">
                    {% if recipe in user.favorites.all %}favorite{% else %}favorite_border{% endif %}
                </i>
             </a>
         </div>
         {% endif %}
       </div>
       
       <div class="padding">
         <h5 class="truncate pointer" onclick="location.href='{% url 'recipe_detail' recipe.slug %}';">{{ recipe.title }}</h5>
         
         <div class="row align-center">
            {% if recipe.uploaded_by %}
                {% if recipe.uploaded_by.avatar %}
                <img src="{{ recipe.uploaded_by.avatar.url }}" class="circle tiny" alt="{{ recipe.uploaded_by.username }}">
                {% else %}
                <i class="tiny circle surface">person</i>
                {% endif %}
                <span class="tiny-text left-margin">{{ recipe.uploaded_by.username }}</span>
            {% else %}
                <i class="tiny circle surface">person_off</i>
                <span class="tiny-text left-margin">{% trans "Unknown" %}</span>
            {% endif %}
         </div>
         
         <div class="space"></div>
         
         <div class="row wrap">
           {% for tag in recipe.tags.all %}
           <span class="chip small round surface margin-bottom">{{ tag.name }}</span>
           {% endfor %}
         </div>
       </div>
       
       <div class="padding pt-0">
         <a href="{% url 'recipe_detail' recipe.slug %}" class="button fill round responsive">
           <span>{% trans 'View Recipe' %}</span>
           <i class="suffix">arrow_forward</i>
         </a>
       </div>
    </article>
  </div>
  {% empty %}
  <div class="s12 center-align">
    <div class="large-space"></div>
    <i class="extra gray-text">no_food</i>
    <h5 class="gray-text">{% trans "No sandwitches found." %}</h5>
    <p>{% trans "Be the first to create one!" %}</p>
    {% if user.is_authenticated %}
    <a href="{% url 'admin:sandwitches_recipe_add' %}" class="button primary round">{% trans "Add Recipe" %}</a>
    {% endif %}
  </div>
  {% endfor %}
</div>

{% endblock %}

{% block page_scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
  const search = document.getElementById('search');
  if (!search) return;
  search.addEventListener('input', function() {
    const q = this.value.toLowerCase().trim();
    document.querySelectorAll('.recipe-card').forEach(card => {
      const title = (card.querySelector('h5')?.textContent || '').toLowerCase();
      const tags = Array.from(card.querySelectorAll('.chip')).map(t => t.textContent.toLowerCase());
      const match = !q || title.includes(q) || tags.some(t => t.includes(q));
      card.style.display = match ? '' : 'none';
    });
  });
});
</script>
{% endblock %}